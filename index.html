<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>소화기 점검 어플 시제품</title>
  <style>
    /* 공통 스타일 */
    .page { display: none; padding: 20px; }
    .active { display: block; }
    .btn {
      display: inline-block;
      padding: 10px 20px;
      margin: 10px 5px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
    }
    .btn-green { background-color: #4CAF50; color: white; }
    .btn-red { background-color: #F44336; color: white; }
    
    /* 카메라 프리뷰 박스: video와 img 모두 사용 */
    .camera-box {
      border: 2px solid #ccc;
      width: 100%;
      max-width: 500px;
      height: 300px;
      margin-bottom: 10px;
      position: relative;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .camera-box video,
    .camera-box img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #aaa; padding: 8px; text-align: center; }
    
    /* 버튼 행: 뒤로가기 버튼 왼쪽 배치 */
    .button-row {
      display: flex;
      justify-content: flex-end;
      align-items: center;
    }
    .button-row .btn.back {
      margin-right: auto;
    }
    
    /* 소화기 위치 입력란 (페이지 2) */
    #fireExtinguisherNumber {
      width: 100%;
      max-width: 500px;
      font-size: 18px;
      padding: 8px;
    }
    
    /* 페이지 0: 시작 페이지 */
    #page0 { text-align: center; }
    #page0 img { max-width: 80%; margin-top: 20px; display: block; margin-left: auto; margin-right: auto; }
    
    /* 페이지 1: 컨텐츠를 좌측 상단 정렬 */
    #page1 .container {
      margin: 20px 0 0 0;
      width: 90%;
      max-width: 500px;
      text-align: left;
    }
    .input-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    
    /* 하단 persistent bar: Flexbox로 좌측, 가운데, 우측 정렬 */
    #persistentBar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 30px;
      background: #005b90;
      color: #fff;
      font-size: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 5px;
      box-sizing: border-box;
      display: none;
    }
    #persistentBar span { }
  </style>
  
  <!-- Firebase 초기화: ES 모듈 방식 -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-analytics.js";
    import { getFirestore, collection, addDoc, updateDoc, doc, query, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";
    
    const firebaseConfig = {
      apiKey: "AIzaSyBOtHtUnIUq-CrdghMEnJusuXk3CSQ6VwE",
      authDomain: "fire-extinguisher-inspection.firebaseapp.com",
      projectId: "fire-extinguisher-inspection",
      storageBucket: "fire-extinguisher-inspection.firebasestorage.app",
      messagingSenderId: "96312144079",
      appId: "1:96312144079:web:e27e0b93b217872f7307ba",
      measurementId: "G-04NW81RZGN"
    };
    
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getFirestore(app);
    
    window.db = db;
    window.collection = collection;
    window.addDoc = addDoc;
    window.updateDoc = updateDoc;
    window.doc = doc;
    window.query = query;
    window.orderBy = orderBy;
    window.getDocs = getDocs;
  </script>
</head>
<body>
  <!-- Persistent bottom bar: 좌측 점검자 이름, 가운데 소속, 우측 소화기 위치 -->
  <div id="persistentBar">
    <span id="barInspectorName"></span>
    <span id="barDept"></span>
    <span id="barFireExtinguisherNumber"></span>
  </div>
  
  <!-- 페이지 0: 시작 페이지 -->
  <div id="page0" class="page active">
    <h1>소화기 안전점검</h1>
    <!-- 메인 이미지로 카카오 CDN 이미지 URL 사용 -->
    <img src="https://i.imgur.com/1yMnhYv.png" alt="메인 이미지">
    <br>
    <button class="btn btn-green" onclick="goToPage(1)">점검 시작하기</button>
  </div>
  
  <!-- 페이지 1: 점검자 이름 및 소속 입력 (좌측 상단 정렬) -->
  <div id="page1" class="page">
    <div class="container">
      <div class="input-row">
        <label for="inspectorName">점검자 이름:</label>
        <input type="text" id="inspectorName" placeholder="이름 입력" />
      </div>
      <div class="input-row">
        <label for="inspectorDept">소속:</label>
        <input type="text" id="inspectorDept" placeholder="소속 입력" />
      </div>
      <button class="btn" onclick="saveInspectorInfoAndNext()">다음</button>
    </div>
  </div>
  
  <!-- 페이지 2: 소화기 위치 입력 및 촬영 -->
  <div id="page2" class="page">
    <h2>소화기 위치를 작성해주세요</h2>
    <input type="text" id="fireExtinguisherNumber" placeholder="소화기 위치 입력 (예시: A-01열)" />
    <br><br>
    <h3>소화기 위치를 촬영해주세요</h3>
    <div class="camera-box">
      <video id="locationVideo" autoplay playsinline style="display:block;"></video>
      <img id="locationImg" style="display:none;" />
    </div>
    <div class="button-row">
      <button class="btn back" onclick="goToPage(1)">뒤로가기</button>
      <button class="btn" id="captureLocationButton" onclick="toggleLocationCapture()">촬영하기</button>
      <button class="btn" id="nextButtonPage2" onclick="goToPage(3)" disabled>다음</button>
    </div>
  </div>
  
  <!-- 페이지 3: 소화기의 압력게이지 촬영 -->
  <div id="page3" class="page">
    <h2>소화기의 압력게이지를 촬영해주세요</h2>
    <div class="camera-box">
      <video id="gaugeVideo" autoplay playsinline style="display:block;"></video>
      <img id="gaugeImg" style="display:none;" />
    </div>
    <div class="button-row">
      <button class="btn back" onclick="goToPage(2)">뒤로가기</button>
      <button class="btn" id="captureGaugeButton" onclick="toggleGaugeCapture()">촬영하기</button>
      <button class="btn" id="nextButtonPage3" onclick="goToPage(4)" disabled>다음</button>
    </div>
  </div>
  
  <!-- 페이지 4: 점검 결과 선택 -->
  <div id="page4" class="page">
    <h2>점검 결과를 선택하세요</h2>
    <button class="btn btn-green" onclick="selectResult('양호')">양호</button>
    <button class="btn btn-red" onclick="selectResult('불량')">불량</button>
    <br>
    <button class="btn" onclick="goToPage(3)">뒤로가기</button>
  </div>
  
  <!-- 페이지 5: 점검 완료 후 확인 페이지 -->
  <div id="page5" class="page">
    <h2>점검이 완료되었습니다</h2>
    <p id="resultText"></p>
    <p>저장된 점검자 이름: <span id="savedName"></span></p>
    <p>저장된 소화기 위치: <span id="savedNumber"></span></p>
    <p>저장된 점
